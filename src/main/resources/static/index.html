<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenManus Java - 智能Agent系统控制台</title>
    
    <!-- Vue.js 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Element Plus UI Library -->
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/element-plus"></script>
    
    <!-- Element Plus Icons -->
    <script src="https://unpkg.com/@element-plus/icons-vue"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .app-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }
        
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .header h1 {
            margin: 0 0 15px 0;
            color: #2c3e50;
            font-size: 2.5em;
            font-weight: 700;
        }
        
        .header p {
            margin: 0;
            color: #6c757d;
            font-size: 1.2em;
            line-height: 1.6;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }
        
        .feature-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
            border-color: rgba(102, 126, 234, 0.3);
        }
        
        .feature-icon {
            font-size: 3em;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .feature-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .feature-description {
            color: #6c757d;
            line-height: 1.6;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .feature-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.9em;
            color: #28a745;
            font-weight: 500;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #28a745;
        }
        
        .info-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            text-align: center;
        }
        
        .info-title {
            font-size: 1.3em;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 15px;
        }
        
        .info-content {
            color: #6c757d;
            line-height: 1.6;
        }
        
        .quick-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .feature-card {
            animation: fadeIn 0.6s ease-out;
        }
        
        .feature-card:nth-child(1) { animation-delay: 0.1s; }
         .feature-card:nth-child(2) { animation-delay: 0.2s; }
         .feature-card:nth-child(3) { animation-delay: 0.3s; }
         .feature-card:nth-child(4) { animation-delay: 0.4s; }
         .feature-card:nth-child(5) { animation-delay: 0.5s; }
         .feature-card:nth-child(6) { animation-delay: 0.6s; }
    </style>
</head>
<body>
    <div id="app">
        <div class="app-container">
            <!-- 页面头部 -->
            <div class="header">
                <h1>🤖 OpenManus Java</h1>
                <p>智能Agent系统控制台 - 统一管理和监控所有Agent功能模块</p>
            </div>
            
            <!-- 功能模块网格 -->
            <div class="features-grid">
                <!-- 智能对话系统 -->
                <div class="feature-card" @click="navigateTo('chat')">
                    <div class="feature-icon">💬</div>
                    <div class="feature-title">智能对话系统</div>
                    <div class="feature-description">
                        基于Think-Do-Reflect架构的智能对话系统，支持复杂推理和多轮对话
                    </div>
                    <div class="feature-status">
                        <div class="status-dot"></div>
                        系统运行中
                    </div>
                </div>
                
                <!-- Agent执行监控 -->
                <div class="feature-card" @click="navigateTo('pages/agent-monitoring.html')">
                    <div class="feature-icon">🤖</div>
                    <div class="feature-title">Agent执行监控</div>
                    <div class="feature-description">
                        可视化监控Agent执行流程，展示思考、执行、反思各个阶段的输入输出和LLM交互
                    </div>
                    <div class="feature-status">
                        <div class="status-dot"></div>
                        实时监控
                    </div>
                </div>
                
                <!-- Think-Do-Reflect工作流 -->
                <div class="feature-card" @click="navigateTo('pages/think-do-reflect.html')">
                    <div class="feature-icon">🧠</div>
                    <div class="feature-title">Think-Do-Reflect工作流</div>
                    <div class="feature-description">
                        专门的Think-Do-Reflect工作流界面，支持步骤化执行和结果展示
                    </div>
                    <div class="feature-status">
                        <div class="status-dot"></div>
                        工作流就绪
                    </div>
                </div>
                
                <!-- API文档 -->
                <div class="feature-card" @click="navigateTo('swagger-ui.html')">
                    <div class="feature-icon">📚</div>
                    <div class="feature-title">API文档</div>
                    <div class="feature-description">
                        Swagger UI接口文档，查看所有可用的REST API接口
                    </div>
                    <div class="feature-status">
                        <div class="status-dot"></div>
                        文档就绪
                    </div>
                </div>
                
                <!-- Agent监控测试 -->
                <div class="feature-card" @click="startMonitoringTest()">
                    <div class="feature-icon">🎮</div>
                    <div class="feature-title">监控测试</div>
                    <div class="feature-description">
                        启动Agent执行监控功能的演示和测试，可在统一监控界面查看结果
                    </div>
                    <div class="feature-status">
                        <div class="status-dot"></div>
                        测试就绪
                    </div>
                </div>
            </div>
            
            <!-- 系统信息 -->
            <div class="info-panel">
                <div class="info-title">🚀 系统状态</div>
                <div class="info-content">
                    OpenManus Java智能Agent系统正在运行中。所有功能模块已就绪，可以开始使用。<br>
                    点击上方功能卡片进入相应的功能模块。
                </div>
                <div class="quick-actions">
                    <el-button type="primary" @click="navigateTo('chat')">
                        <el-icon><ChatDotRound /></el-icon>
                        开始对话
                    </el-button>
                    <el-button type="success" @click="navigateTo('pages/agent-monitoring.html')">
                        <el-icon><Monitor /></el-icon>
                        Agent监控
                    </el-button>
                    <el-button type="info" @click="refreshStatus">
                        <el-icon><Refresh /></el-icon>
                        刷新状态
                    </el-button>
                </div>
            </div>
        </div>
    </div>
        
    
    <!-- Vue.js 应用脚本 -->
    <script>
        const { createApp } = Vue;
        const { ElMessage, ElMessageBox } = ElementPlus;
        
        createApp({
            data() {
                return {
                    systemStatus: 'running'
                };
            },
            methods: {
                navigateTo(page) {
                    if (page === 'chat') {
                        // 重新加载当前页面作为对话系统
                        this.loadChatInterface();
                    } else {
                        // 导航到其他页面
                        window.location.href = page;
                    }
                },
                
                loadChatInterface() {
                    // 这里可以动态加载对话界面
                    ElMessage.info('正在加载智能对话系统...');
                    // 实际实现中可以通过AJAX加载对话界面的HTML
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                },
                
                refreshStatus() {
                    ElMessage.success('系统状态已刷新');
                    // 这里可以添加实际的状态检查逻辑
                },

                async startMonitoringTest() {
                    try {
                        ElMessage.info('正在启动监控测试...');

                        // 调用监控测试API
                        const response = await fetch('/api/agent-monitor-test/simulate-think-do-reflect', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                userInput: '测试Think-Do-Reflect工作流的监控功能'
                            })
                        });

                        if (response.ok) {
                            const result = await response.json();
                            ElMessage.success(`监控测试已启动，会话ID: ${result.sessionId}`);
                            ElMessage.info('请前往统一监控界面查看执行过程');

                            // 3秒后自动打开监控界面
                            setTimeout(() => {
                                this.navigateTo('pages/agent-monitoring.html');
                            }, 3000);
                        } else {
                            throw new Error(`HTTP ${response.status}`);
                        }
                    } catch (error) {
                        console.error('启动监控测试失败:', error);
                        ElMessage.error('启动监控测试失败: ' + error.message);
                    }
                }
            },
            
            mounted() {
                // 页面加载完成后的初始化
                console.log('OpenManus Java 控制台已加载');
            }
        }).use(ElementPlus).mount('#app');
     </script>
 </body>
 </html>
                        
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        
                        const data = await response.json();
                        console.log("API 返回数据:", data);
                        
                        // 处理后端返回的数据格式
                        const answer = data.answer || '抱歉，我无法理解您的问题。';
                        
                        // 添加 AI 响应 - 确保使用完整内容
                        const messageIndex = messages.value.length;
                        
                        messages.value.push({
                            role: 'assistant',
                            content: answer,
                            answer: answer,
                            conversationId: data.conversationId,
                            timestamp: data.timestamp,
                            // 如果后端返回了推理信息，保留这些字段
                            cot: data.cot || [],
                            reasoning_steps: data.reasoning_steps || [],
                            tool_calls: data.tool_calls || [],
                            observations: data.observations || [],
                            reflections: data.reflections || [],
                            iteration_count: data.iteration_count || 0
                        });
                        
                        // 默认设置长回答为折叠状态
                        if (isLongAnswer(messages.value[messageIndex])) {
                            expandedAnswers[messageIndex] = false;
                        }
                        
                        // 隐藏推理过程面板
                        hideCot();
                        
                        // 滚动到底部
                        await nextTick();
                        scrollToBottom();
                        
                    } catch (err) {
                        console.error('发送消息时出错:', err);
                        
                        // 尝试解析错误响应
                        let errorMessage = '发送消息失败';
                        if (err.response) {
                            try {
                                const errorData = await err.response.json();
                                errorMessage = errorData.error || errorMessage;
                            } catch (parseErr) {
                                errorMessage = `HTTP ${err.response.status}: ${err.response.statusText}`;
                            }
                        } else {
                            errorMessage = err.message || errorMessage;
                        }
                        
                        error.value = errorMessage;
                        ElMessage.error(errorMessage);
                    } finally {
                        loading.value = false;
                    }
                };
                
                // 滚动到底部
                const scrollToBottom = () => {
                    if (messagesContainer.value) {
                        messagesContainer.value.scrollTop = messagesContainer.value.scrollHeight;
                    }
                };

                // 打开页面
                const openPage = (url) => {
                    window.open(url, '_blank');
                };

                return {
                    messages,
                    inputMessage,
                    loading,
                    error,
                    messagesContainer,
                    cotContentContainer,
                    activeCotIndex,
                    activeCotSteps,
                    activeReasoningSteps,
                    activeToolCalls,
                    activeObservations,
                    activeReflections,
                    hasDetailedInfo,
                    expandedAnswers,
                    conversationId,
                    agentInfo,
                    isLongAnswer,
                    toggleAnswer,
                    sendMessage,
                    renderMarkdown,
                    showCot,
                    hideCot,
                    startNewConversation,
                    openPage
                };
            }
        }).use(ElementPlus).mount('#app');
        
        // 注册 Element Plus 图标
        const app = createApp({});
        for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
            app.component(key, component);
        }
        
        // 确保图标组件可用
        const {
            ChatDotRound,
            View,
            Close,
            Promotion,
            ArrowUp,
            ArrowDown,
            Plus,
            InfoFilled,
            Menu,
            BrainFilled,
            Monitor,
            DataAnalysis,
            CircleCheck
        } = ElementPlusIconsVue;
    </script>
</body>
</html>