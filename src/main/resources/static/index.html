<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenManus - AI Êô∫ËÉΩÂ∑•‰ΩúÂè∞</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css">
    <script src="https://unpkg.com/element-plus"></script>
    <script src="https://unpkg.com/@element-plus/icons-vue"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/styles/github-dark.css">
    <script src="https://cdn.jsdelivr.net/npm/highlight.js@11.7.0/lib/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sockjs-client@1.6.1/dist/sockjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stompjs@2.3.3/lib/stomp.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #141414;
            --bg-tertiary: #1a1a1a;
            --bg-card: #1e1e1e;
            --border-color: #2a2a2a;
            --border-light: #333;
            --text-primary: #fafafa;
            --text-secondary: #a0a0a0;
            --text-muted: #666;
            --accent: #3b82f6;
            --accent-soft: rgba(59, 130, 246, 0.1);
            --success: #22c55e;
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --shadow: 0 1px 3px rgba(0,0,0,0.3);
            --shadow-lg: 0 4px 20px rgba(0,0,0,0.4);
            --font-sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-sans); background: var(--bg-primary); color: var(--text-primary); line-height: 1.6; overflow: hidden; }
        
        .app-container { width: 100vw; height: 100vh; display: flex; flex-direction: column; }
        
        /* È°∂ÈÉ®ÂØºËà™ - ÊûÅÁÆÄÈ£éÊ†º */
        .top-nav {
            height: 56px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            flex-shrink: 0;
        }
        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            font-size: 16px;
            color: var(--text-primary);
        }
        .logo-icon { font-size: 24px; }
        .nav-right { display: flex; align-items: center; gap: 16px; }
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
            color: var(--text-secondary);
        }
        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--success);
            border-radius: 50%;
        }
        .btn-primary {
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 500;
            color: #fff;
            background: var(--accent);
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .btn-primary:hover { opacity: 0.9; }
        
        /* ‰∏ªÂ∑•‰ΩúÂå∫ */
        .workspace {
            flex: 1;
            display: flex;
            gap: 1px;
            background: var(--border-color);
            overflow: hidden;
        }
        
        /* Èù¢ÊùøÈÄöÁî®Ê†∑Âºè */
        .panel {
            background: var(--bg-secondary);
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .panel-header {
            height: 48px;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--border-color);
            flex-shrink: 0;
        }
        .panel-title {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        /* ËÅäÂ§©Èù¢Êùø */
        .chat-panel { width: 420px; min-width: 360px; }
        
        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }
        .messages-container::-webkit-scrollbar { width: 6px; }
        .messages-container::-webkit-scrollbar-track { background: transparent; }
        .messages-container::-webkit-scrollbar-thumb { background: var(--border-light); border-radius: 3px; }
        
        /* Ê¨¢ËøéÁïåÈù¢ */
        .welcome-screen {
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: var(--text-muted);
        }
        .welcome-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.6; }
        .welcome-title { font-size: 20px; font-weight: 600; color: var(--text-primary); margin-bottom: 8px; }
        .welcome-subtitle { font-size: 14px; }
        
        /* Ê∂àÊÅØÊ†∑Âºè */
        .message { margin-bottom: 20px; }
        .message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }
        .message-avatar {
            width: 28px;
            height: 28px;
            border-radius: var(--radius-sm);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            background: var(--bg-tertiary);
        }
        .assistant-message .message-avatar { background: var(--accent-soft); }
        .message-role {
            font-size: 13px;
            font-weight: 500;
            color: var(--text-primary);
        }
        .message-time {
            font-size: 11px;
            color: var(--text-muted);
            margin-left: auto;
        }
        .message-content {
            padding: 14px 16px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-md);
            font-size: 14px;
            line-height: 1.7;
        }
        .user-message .message-content {
            background: var(--accent-soft);
        }
        
        /* ÊÄùËÄÉÊó•Âøó */
        .thinking-logs {
            margin-top: 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            overflow: hidden;
        }
        .logs-header {
            padding: 10px 14px;
            background: var(--bg-card);
            display: flex;
            align-items: center;
            justify-content: space-between;
            cursor: pointer;
            font-size: 12px;
            color: var(--text-secondary);
        }
        .logs-header:hover { background: var(--bg-tertiary); }
        .logs-content {
            max-height: 200px;
            overflow-y: auto;
            padding: 10px;
            background: var(--bg-primary);
        }
        .logs-content.collapsed { display: none; }
        .log-entry {
            padding: 8px 10px;
            margin-bottom: 6px;
            background: var(--bg-secondary);
            border-radius: 6px;
            font-size: 12px;
            font-family: var(--font-mono);
        }
        .log-time { color: var(--text-muted); font-size: 10px; }
        .log-message { color: var(--text-secondary); margin-top: 4px; word-break: break-word; }
        
        /* ËæìÂÖ•Âå∫Âüü */
        .input-area {
            padding: 16px 20px;
            border-top: 1px solid var(--border-color);
            background: var(--bg-secondary);
        }
        .input-actions {
            margin-top: 12px;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        .btn-secondary {
            padding: 8px 16px;
            font-size: 13px;
            color: var(--text-secondary);
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: all 0.2s;
        }
        .btn-secondary:hover { border-color: var(--border-light); color: var(--text-primary); }
        
        /* Â∑•ÂÖ∑Èù¢Êùø */
        .tool-panel { width: 380px; min-width: 320px; transition: width 0.3s; }
        .tool-panel.collapsed { width: 0; min-width: 0; overflow: hidden; }
        
        .tool-tabs {
            display: flex;
            padding: 8px 12px;
            gap: 4px;
            border-bottom: 1px solid var(--border-color);
        }
        .tool-tab {
            flex: 1;
            padding: 8px 12px;
            font-size: 12px;
            font-weight: 500;
            text-align: center;
            color: var(--text-muted);
            background: transparent;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .tool-tab:hover { color: var(--text-secondary); background: var(--bg-tertiary); }
        .tool-tab.active { color: var(--text-primary); background: var(--bg-tertiary); }
        
        .tool-content { flex: 1; overflow-y: auto; padding: 16px; }
        
        /* ÊêúÁ¥¢ÁªìÊûú */
        .search-result-item {
            padding: 14px;
            margin-bottom: 10px;
            background: var(--bg-tertiary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            transition: background 0.2s;
        }
        .search-result-item:hover { background: var(--bg-card); }
        .result-title { font-size: 14px; font-weight: 500; color: var(--accent); margin-bottom: 6px; }
        .result-url { font-size: 11px; color: var(--text-muted); margin-bottom: 6px; font-family: var(--font-mono); word-break: break-all; }
        .result-snippet { font-size: 13px; color: var(--text-secondary); line-height: 1.5; }
        
        /* ÊµèËßàÂô®Èù¢Êùø */
        .browser-panel { flex: 1; min-width: 480px; }
        
        .browser-tabs {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            border-bottom: 1px solid var(--border-color);
            overflow-x: auto;
        }
        .browser-tab {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 12px;
            color: var(--text-secondary);
            cursor: pointer;
            white-space: nowrap;
            min-width: 120px;
            transition: all 0.2s;
        }
        .browser-tab:hover { border-color: var(--border-light); }
        .browser-tab.active { background: var(--bg-card); border-color: var(--accent); color: var(--text-primary); }
        .tab-title { flex: 1; overflow: hidden; text-overflow: ellipsis; }
        .tab-close {
            width: 16px; height: 16px;
            display: flex; align-items: center; justify-content: center;
            font-size: 10px; color: var(--text-muted);
            border-radius: 4px;
            transition: all 0.2s;
        }
        .tab-close:hover { background: rgba(255,255,255,0.1); color: var(--text-primary); }
        .new-tab-btn {
            width: 28px; height: 28px;
            display: flex; align-items: center; justify-content: center;
            background: transparent;
            border: 1px dashed var(--border-color);
            border-radius: 6px;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
        }
        .new-tab-btn:hover { border-color: var(--border-light); color: var(--text-secondary); }
        
        .address-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 12px;
            border-bottom: 1px solid var(--border-color);
        }
        .nav-btn {
            width: 32px; height: 32px;
            display: flex; align-items: center; justify-content: center;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            color: var(--text-muted);
            cursor: pointer;
            transition: all 0.2s;
        }
        .nav-btn:hover { border-color: var(--border-light); color: var(--text-secondary); }
        .url-input-wrapper {
            flex: 1;
            display: flex;
            align-items: center;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            padding: 0 12px;
            transition: border-color 0.2s;
        }
        .url-input-wrapper:focus-within { border-color: var(--accent); }
        .url-icon { color: var(--text-muted); margin-right: 8px; font-size: 14px; }
        .url-input {
            flex: 1;
            background: transparent;
            border: none;
            outline: none;
            padding: 8px 0;
            font-size: 13px;
            font-family: var(--font-mono);
            color: var(--text-primary);
        }
        .url-input::placeholder { color: var(--text-muted); }
        .mode-toggle {
            display: flex;
            gap: 2px;
            padding: 2px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
        }
        .mode-btn {
            padding: 6px 12px;
            font-size: 11px;
            font-weight: 500;
            color: var(--text-muted);
            background: transparent;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .mode-btn:hover { color: var(--text-secondary); }
        .mode-btn.active { background: var(--bg-card); color: var(--text-primary); }
        .open-external {
            padding: 6px 12px;
            font-size: 12px;
            color: var(--text-secondary);
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .open-external:hover { border-color: var(--accent); color: var(--accent); }
        .proxy-toggle {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            background: var(--bg-tertiary);
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-size: 11px;
            color: var(--text-muted);
            transition: all 0.2s;
        }
        .proxy-toggle:hover { border-color: var(--border-light); color: var(--text-secondary); }
        .proxy-toggle input[type="checkbox"] {
            width: 14px;
            height: 14px;
            accent-color: var(--accent);
            cursor: pointer;
        }
        .proxy-toggle:has(input:checked) { border-color: var(--accent); color: var(--accent); }
        .proxy-label { font-weight: 500; }
        
        .browser-content {
            flex: 1;
            position: relative;
            background: var(--bg-primary);
        }
        .browser-iframe { width: 100%; height: 100%; border: none; background: #fff; }
        
        /* Á©∫Áä∂ÊÄÅ */
        .empty-state {
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: var(--text-muted);
        }
        .empty-icon { font-size: 40px; margin-bottom: 12px; opacity: 0.5; }
        .empty-text { font-size: 14px; }
        .iframe-fallback {
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }
        .iframe-fallback-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.6; }
        .iframe-fallback-title { font-size: 16px; font-weight: 500; color: var(--text-primary); margin-bottom: 8px; }
        .iframe-fallback-desc { font-size: 13px; margin-bottom: 20px; max-width: 300px; }
        .iframe-fallback-btn {
            padding: 10px 20px;
            font-size: 13px;
            font-weight: 500;
            color: #fff;
            background: var(--accent);
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: opacity 0.2s;
        }
        .iframe-fallback-btn:hover { opacity: 0.9; }
        
        /* Âä†ËΩΩÂä®Áîª */
        .loading-spinner {
            width: 32px; height: 32px;
            border: 2px solid var(--border-color);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Markdown */
        .markdown-content { line-height: 1.7; }
        .markdown-content h1, .markdown-content h2, .markdown-content h3 {
            font-weight: 600;
            margin: 16px 0 10px;
            color: var(--text-primary);
        }
        .markdown-content h1 { font-size: 18px; }
        .markdown-content h2 { font-size: 16px; }
        .markdown-content h3 { font-size: 15px; }
        .markdown-content p { margin-bottom: 12px; }
        .markdown-content code {
            font-family: var(--font-mono);
            font-size: 13px;
            padding: 2px 6px;
            background: var(--bg-card);
            border-radius: 4px;
            color: var(--accent);
        }
        .markdown-content pre {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 14px;
            margin: 12px 0;
            overflow-x: auto;
        }
        .markdown-content pre code { padding: 0; background: transparent; color: var(--text-primary); }
        .markdown-content a { color: var(--accent); text-decoration: none; }
        .markdown-content a:hover { text-decoration: underline; }
        .markdown-content ul, .markdown-content ol { margin: 10px 0; padding-left: 20px; }
        .markdown-content li { margin-bottom: 6px; }
        
        /* Element Plus Ë¶ÜÁõñ */
        .el-textarea__inner {
            background: var(--bg-tertiary) !important;
            border: 1px solid var(--border-color) !important;
            border-radius: var(--radius-sm) !important;
            color: var(--text-primary) !important;
            box-shadow: none !important;
            font-family: var(--font-sans) !important;
            font-size: 14px !important;
        }
        .el-textarea__inner:focus { border-color: var(--accent) !important; }
        .el-textarea__inner::placeholder { color: var(--text-muted) !important; }
        
        /* ÂìçÂ∫îÂºè */
        @media (max-width: 1200px) {
            .chat-panel { width: 380px; min-width: 320px; }
            .tool-panel { width: 320px; min-width: 280px; }
        }
        @media (max-width: 1000px) {
            .workspace { flex-direction: column; }
            .chat-panel, .tool-panel, .browser-panel { width: 100%; min-width: 0; }
            .chat-panel { height: 40%; }
            .tool-panel { height: 25%; }
            .browser-panel { flex: 1; min-height: 200px; }
        }
        
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border-light); border-radius: 3px; }
        ::selection { background: rgba(59, 130, 246, 0.3); }
    </style>
</head>
<body>
    <div id="app">
        <div class="app-container">
            <div class="top-nav">
                <div class="logo">
                    <span class="logo-icon">üß†</span>
                    <span>OpenManus</span>
                </div>
                <div class="nav-right">
                    <div class="status-indicator">
                        <span class="status-dot"></span>
                        <span>Âú®Á∫ø</span>
                    </div>
                    <button class="btn-primary" @click="startNewConversation">Êñ∞ÂØπËØù</button>
                </div>
            </div>
            <div class="workspace">
                <div class="chat-panel panel">
                    <div class="panel-header">
                        <span class="panel-title">ÂØπËØù</span>
                    </div>
                    <div class="messages-container" ref="messagesContainer">
                        <div v-if="messages.length===0" class="welcome-screen">
                            <div class="welcome-icon">üí¨</div>
                            <div class="welcome-title">ÂºÄÂßãÂØπËØù</div>
                            <div class="welcome-subtitle">ËæìÂÖ•‰Ω†ÁöÑÈóÆÈ¢òÔºåAI Â∞Ü‰∏∫‰Ω†Ëß£Á≠î</div>
                        </div>
                        <div v-for="(msg,idx) in messages" :key="idx" :class="['message', msg.role+'-message']">
                            <div class="message-header">
                                <div class="message-avatar">{{ msg.role==='user' ? 'üë§' : 'ÔøΩÔøΩ' }}</div>
                                <span class="message-role">{{ msg.role==='user' ? '‰Ω†' : 'AI' }}</span>
                                <span class="message-time">{{ msg.time }}</span>
                            </div>
                            <div class="message-content">
                                <div class="markdown-content" v-html="renderMarkdown(msg.content)"></div>
                                <div v-if="msg.logs && msg.logs.length" class="thinking-logs">
                                    <div class="logs-header" @click="msg.logsCollapsed=!msg.logsCollapsed">
                                        <span>ÊÄùËÄÉËøáÁ®ã ({{ msg.logs.length }})</span>
                                        <span>{{ msg.logsCollapsed ? '‚ñ∂' : '‚ñº' }}</span>
                                    </div>
                                    <div class="logs-content" :class="{collapsed:msg.logsCollapsed}">
                                        <div v-for="(log,i) in msg.logs" :key="i" class="log-entry">
                                            <div class="log-time">{{ log.timestamp }}</div>
                                            <div class="log-message">{{ log.message }}</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div v-if="loading" class="message assistant-message">
                            <div class="message-header">
                                <div class="message-avatar">ü§ñ</div>
                                <span class="message-role">AI</span>
                            </div>
                            <div class="message-content" style="display:flex;justify-content:center;padding:20px">
                                <div class="loading-spinner"></div>
                            </div>
                        </div>
                    </div>
                    <div class="input-area">
                        <el-input v-model="inputMessage" type="textarea" :rows="3" placeholder="ËæìÂÖ•Ê∂àÊÅØÔºåCtrl+Enter ÂèëÈÄÅ..." :disabled="loading" @keydown.ctrl.enter="sendMessage"></el-input>
                        <div class="input-actions">
                            <button class="btn-secondary" @click="inputMessage=''" :disabled="loading">Ê∏ÖÁ©∫</button>
                            <button class="btn-primary" @click="sendMessage" :disabled="loading">ÂèëÈÄÅ</button>
                        </div>
                    </div>
                </div>
                <div class="tool-panel panel" :class="{collapsed:!showToolPanel}">
                    <div class="panel-header">
                        <span class="panel-title">Â∑•ÂÖ∑</span>
                        <button class="tab-close" @click="showToolPanel=false">‚úï</button>
                    </div>
                    <div class="tool-tabs">
                        <button :class="['tool-tab',activeToolTab==='search'?'active':'']" @click="activeToolTab='search'">ÊêúÁ¥¢ÁªìÊûú</button>
                        <button :class="['tool-tab',activeToolTab==='output'?'active':'']" @click="activeToolTab='output'">ËæìÂá∫Êó•Âøó</button>
                    </div>
                    <div class="tool-content">
                        <div v-if="activeToolTab==='search'">
                            <div v-if="!searchResults.length" class="empty-state">
                                <div class="empty-icon">üîç</div>
                                <div class="empty-text">ÊöÇÊó†ÊêúÁ¥¢ÁªìÊûú</div>
                            </div>
                            <div v-else>
                                <div v-for="(r,i) in searchResults" :key="i" class="search-result-item" @click="openInBrowser(r.url)">
                                    <div class="result-title">{{ r.title }}</div>
                                    <div class="result-url">{{ r.url }}</div>
                                    <div class="result-snippet">{{ r.snippet }}</div>
                                </div>
                            </div>
                        </div>
                        <div v-if="activeToolTab==='output'">
                            <div v-if="!toolOutputs.length" class="empty-state">
                                <div class="empty-icon">üìÑ</div>
                                <div class="empty-text">ÊöÇÊó†ËæìÂá∫</div>
                            </div>
                            <div v-else>
                                <div v-for="(o,i) in toolOutputs" :key="i" class="search-result-item">
                                    <div class="result-title">{{ o.type }}</div>
                                    <div class="result-url">{{ o.time }}</div>
                                    <div class="markdown-content" v-html="renderMarkdown(o.content)"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="browser-panel panel">
                    <div class="browser-tabs">
                        <div v-for="tab in browserTabs" :key="tab.id" :class="['browser-tab',activeBrowserTab===tab.id?'active':'']" @click="switchBrowserTab(tab.id)">
                            <span>{{ tab.icon }}</span>
                            <span class="tab-title">{{ tab.title }}</span>
                            <span class="tab-close" @click.stop="closeBrowserTab(tab.id)" v-if="browserTabs.length>1">‚úï</span>
                        </div>
                        <button class="new-tab-btn" @click="createBrowserTab">+</button>
                    </div>
                    <div class="address-bar">
                        <button class="nav-btn" @click="refreshPage" title="Âà∑Êñ∞"><el-icon><Refresh /></el-icon></button>
                        <div class="url-input-wrapper">
                            <el-icon class="url-icon"><Link /></el-icon>
                            <input class="url-input" v-model="currentUrl" placeholder="ËæìÂÖ•ÁΩëÂùÄ..." @keyup.enter="navigateToUrl"/>
                        </div>
                        <button class="open-external" @click="openExternal" v-if="currentUrl" title="Âú®Êñ∞Á™óÂè£ÊâìÂºÄ">
                            <span>‚Üó</span> Êñ∞Á™óÂè£
                        </button>
                        <label class="proxy-toggle" title="ÂºÄÂêØ‰ª£ÁêÜÊ®°ÂºèÂèØ‰ª•ÁªïËøáÁΩëÁ´ôÁöÑiframeÈôêÂà∂">
                            <input type="checkbox" v-model="useProxy" @change="refreshPage">
                            <span class="proxy-label">‰ª£ÁêÜ</span>
                        </label>
                        <div class="mode-toggle">
                            <button :class="['mode-btn',browserMode==='web'?'active':'']" @click="browserMode='web'">ÁΩëÈ°µ</button>
                            <button :class="['mode-btn',browserMode==='vnc'?'active':'']" @click="browserMode='vnc'" v-if="sandboxVncUrl">VNC</button>
                        </div>
                    </div>
                    <div class="browser-content">
                        <div v-if="browserMode==='web'" style="width:100%;height:100%;position:relative">
                            <iframe v-if="currentUrl && !iframeError" :src="getProxyUrl(currentUrl)" class="browser-iframe" @error="onIframeError" @load="onIframeLoad"></iframe>
                            <div v-if="currentUrl && iframeError" class="iframe-fallback">
                                <div class="iframe-fallback-icon">üîí</div>
                                <div class="iframe-fallback-title">Ê≠§ÁΩëÁ´ôÊó†Ê≥ïÂú®Ê≠§È¢ÑËßà</div>
                                <div class="iframe-fallback-desc">ËØ•ÁΩëÁ´ôËÆæÁΩÆ‰∫ÜÂÆâÂÖ®ÈôêÂà∂Ôºå‰∏çÂÖÅËÆ∏Âú®ÂµåÂÖ•Ê°Ü‰∏≠ÊòæÁ§∫„ÄÇËØ∑Âú®Êñ∞Á™óÂè£‰∏≠ÊâìÂºÄ„ÄÇ</div>
                                <button class="iframe-fallback-btn" @click="openExternal">Âú®Êñ∞Á™óÂè£ÊâìÂºÄ</button>
                            </div>
                            <div v-if="!currentUrl" class="empty-state">
                                <div class="empty-icon">üåê</div>
                                <div class="empty-text">ËæìÂÖ•ÁΩëÂùÄÂºÄÂßãÊµèËßà</div>
                            </div>
                        </div>
                        <div v-else style="width:100%;height:100%">
                            <iframe v-if="sandboxVncUrl" :src="sandboxVncUrl" class="browser-iframe" sandbox="allow-scripts allow-same-origin allow-forms allow-pointer-lock"></iframe>
                            <div v-else class="empty-state">
                                <div class="loading-spinner"></div>
                                <div class="empty-text" style="margin-top:16px">VNC ÂêØÂä®‰∏≠...</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        const{createApp,ref,reactive,nextTick,onMounted}=Vue;
        const{ElMessage,ElNotification}=ElementPlus;
        const app=createApp({
            setup(){
                const messages=ref([]);
                const inputMessage=ref('');
                const loading=ref(false);
                const messagesContainer=ref(null);
                const showToolPanel=ref(true);
                const activeToolTab=ref('search');
                const searchResults=ref([]);
                const toolOutputs=ref([]);
                const browserTabs=ref([{id:'tab-1',title:'Êñ∞Ê†áÁ≠æÈ°µ',icon:'üåê',url:''}]);
                const activeBrowserTab=ref('tab-1');
                const browserMode=ref('web');
                const currentUrl=ref('');
                const sandboxVncUrl=ref(null);
                const iframeError=ref(false);
                const useProxy=ref(true);
                const getProxyUrl=(url)=>{if(!url||!useProxy.value)return url;try{const encoded=btoa(unescape(encodeURIComponent(url))).replace(/\+/g,'-').replace(/\//g,'_').replace(/=+$/,'');return'/api/proxy/web?url='+encoded}catch(e){return url}};
                let stompClient=null;
                marked.setOptions({breaks:true,gfm:true});
                const renderMarkdown=(content)=>{if(!content)return'';try{const html=marked.parse(content);setTimeout(()=>{document.querySelectorAll('.markdown-content pre code').forEach(b=>{if(!b.dataset.highlighted){hljs.highlightElement(b);b.dataset.highlighted='yes'}})},50);return html}catch(e){return content}};
                const scrollToBottom=()=>{nextTick(()=>{if(messagesContainer.value)messagesContainer.value.scrollTop=messagesContainer.value.scrollHeight})};
                const formatTime=()=>new Date().toLocaleTimeString('zh-CN',{hour:'2-digit',minute:'2-digit'});
                const sendMessage=async()=>{const text=inputMessage.value.trim();if(!text||loading.value)return;messages.value.push({role:'user',content:text,time:formatTime()});inputMessage.value='';scrollToBottom();loading.value=true;try{const res=await fetch('/api/agent/think-do-reflect-stream',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({input:text})});const data=await res.json();if(!res.ok||!data.success)throw new Error(data.error||'ËØ∑Ê±ÇÂ§±Ë¥•');if(data.sessionId)startSandboxPolling(data.sessionId);connectWebSocket(data.topic)}catch(e){ElMessage.error('ÂèëÈÄÅÂ§±Ë¥•: '+e.message);loading.value=false}};
                const startNewConversation=()=>{messages.value=[];searchResults.value=[];toolOutputs.value=[];ElMessage.success('Â∑≤ÂºÄÂßãÊñ∞ÂØπËØù')};
                const connectWebSocket=(topic)=>{const socket=new SockJS('/ws');stompClient=Stomp.over(socket);stompClient.debug=null;stompClient.connect({},(frame)=>{const msg=reactive({role:'assistant',content:'',time:formatTime(),logs:[],logsCollapsed:false});messages.value.push(msg);stompClient.subscribe(topic+'/logs',(m)=>{try{const log=JSON.parse(m.body);msg.logs.push(log);extractSearchResults(log.message);extractWebUrl(log.message);scrollToBottom()}catch(e){}});stompClient.subscribe(topic,(m)=>{try{const ev=JSON.parse(m.body);if(ev.eventType==='TOOL_CALL_END'&&ev.output){toolOutputs.value.unshift({type:ev.agentName||'Â∑•ÂÖ∑',content:typeof ev.output==='string'?ev.output:JSON.stringify(ev.output,null,2),time:formatTime()});extractSearchResults(ev.output)}else if(ev.eventType==='ERROR'){msg.content='ÊâßË°åÂá∫Èîô: '+(ev.error||'Êú™Áü•ÈîôËØØ');loading.value=false;disconnectWebSocket()}}catch(e){}});stompClient.subscribe(topic+'/result',(m)=>{try{const r=JSON.parse(m.body);msg.content=r.result||'ÂÆåÊàê';msg.logsCollapsed=true;loading.value=false;scrollToBottom();disconnectWebSocket()}catch(e){}})},(e)=>{ElMessage.error('ËøûÊé•Â§±Ë¥•');loading.value=false})};
                const disconnectWebSocket=()=>{if(stompClient){try{stompClient.disconnect()}catch(e){}}};
                const extractSearchResults=(m)=>{if(!m||typeof m!=='string'||!m.includes('üîç ÊêúÁ¥¢ÁªìÊûú:'))return;const lines=m.split('\n');const parsed=[];let cur=null;for(const raw of lines){const line=(raw||'').trim();if(!line)continue;const tm=line.match(/^\d+\.\s*\*\*(.+)\*\*$/);if(tm){if(cur&&cur.title&&cur.url)parsed.push(cur);cur={title:tm[1],url:'',snippet:''};continue}if(cur&&line.startsWith('üîó')){cur.url=line.replace(/^üîó\s*/,'').trim();continue}if(cur&&line.startsWith('üìù')){cur.snippet=line.replace(/^üìù\s*/,'').trim();continue}}if(cur&&cur.title&&cur.url)parsed.push(cur);if(parsed.length){searchResults.value=parsed;showToolPanel.value=true;activeToolTab.value='search'}};
                const extractWebUrl=(m)=>{const match=m.match(/(?:Ê≠£Âú®ËÆøÈóÆ|ÊêúÁ¥¢È°µÈù¢)[:Ôºö\s]*(https?:\/\/[^\s\)]+)/i);if(match&&match[1]){currentUrl.value=match[1];ElNotification({title:'Â∑≤Âä†ËΩΩ',message:'ÁΩëÈ°µÂ∑≤Âú®ÊµèËßàÂô®ÊâìÂºÄ',type:'success',duration:2000,position:'bottom-right'})}};
                const createBrowserTab=()=>{const t={id:'tab-'+Date.now(),title:'Êñ∞Ê†áÁ≠æÈ°µ',icon:'üåê',url:''};browserTabs.value.push(t);activeBrowserTab.value=t.id};
                const closeBrowserTab=(id)=>{const i=browserTabs.value.findIndex(t=>t.id===id);if(i>-1){browserTabs.value.splice(i,1);if(activeBrowserTab.value===id&&browserTabs.value.length)activeBrowserTab.value=browserTabs.value[0].id}};
                const switchBrowserTab=(id)=>{activeBrowserTab.value=id;const t=browserTabs.value.find(x=>x.id===id);if(t)currentUrl.value=t.url};
                const navigateToUrl=()=>{if(!currentUrl.value)return;iframeError.value=false;let url=currentUrl.value.trim();if(!url.startsWith('http://') && !url.startsWith('https://'))url='https://'+url;currentUrl.value=url;const t=browserTabs.value.find(x=>x.id===activeBrowserTab.value);if(t){t.url=url;try{t.title=new URL(url).hostname}catch(e){}}};
                const openInBrowser=(url)=>{iframeError.value=false;currentUrl.value=url;navigateToUrl()};
                const refreshPage=()=>{iframeError.value=false;const f=document.querySelector('.browser-iframe');if(f)f.src=f.src};
                const openExternal=()=>{if(currentUrl.value)window.open(currentUrl.value,'_blank')};
                const onIframeError=()=>{iframeError.value=true};
                const onIframeLoad=(e)=>{iframeError.value=false};
                const startSandboxPolling=async(sid)=>{let attempts=0;const poll=async()=>{if(attempts>=20)return;try{const res=await fetch('/api/agent/session/'+sid);if(res.ok){const data=await res.json();if(data.sandboxVncUrl&&data.sandboxAvailable){sandboxVncUrl.value=data.sandboxVncUrl;ElMessage.success('VNC Â∑≤Â∞±Áª™');return}}}catch(e){}attempts++;setTimeout(poll,3000)};poll()};
                onMounted(()=>{});
                return{messages,inputMessage,loading,messagesContainer,sendMessage,startNewConversation,renderMarkdown,showToolPanel,activeToolTab,searchResults,toolOutputs,browserTabs,activeBrowserTab,browserMode,currentUrl,sandboxVncUrl,iframeError,useProxy,getProxyUrl,createBrowserTab,closeBrowserTab,switchBrowserTab,navigateToUrl,openInBrowser,refreshPage,openExternal,onIframeError,onIframeLoad};
            }
        });
        for(const[k,c] of Object.entries(ElementPlusIconsVue))app.component(k,c);
        app.use(ElementPlus).mount('#app');
    </script>
</body>
</html>
